trigger:
- none

pr:
- main
- releases/*

workspace:
  clean: all

pool:
  name: Core

variables:
  system.debug: true
  
steps:

- script: |
    echo $(System.PullRequest.TargetBranch)
    echo $(System.PullRequest.targetBranchName)
    echo $(System.PullRequest.SourceRepositoryUri)
    echo $(System.PullRequest.SourceBranch)
    echo $(Build.SourceBranch)
    echo $(Build.SourceBranchName)
    echo $(Build.SourceVersion)
    echo $(System.PullRequest.PullRequestId)
    echo $(System.PullRequest.PullRequestNumber)
    
- script: |
    cd $(Build.ArtifactStagingDirectory)
    git init
    git remote add origin $(System.PullRequest.SourceRepositoryUri)
    git config --get-all http.$(System.PullRequest.SourceRepositoryUri).extraheader
    git config --get-all http.extraheader

    git --config-env=http.extraheader=env_var_http.extraheader fetch --force --tags --prune --prune-tags -no-recurse-submodules origin --depth=1  +$(Build.SourceVersion):refs/remotes/origin/$(Build.SourceVersion)

    git --config-env=http.extraheader=env_var_http.extraheader fetch --force --tags --prune --prune-tags  --no-recurse-submodules origin --depth=1  +$(Build.SourceVersion)

    git checkout --progress --force refs/remotes/origin/$(Build.SourceVersion)